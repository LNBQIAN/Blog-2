
@{
    ViewBag.Title = "Add";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="am-cf am-padding am-padding-bottom-0">
    <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">添加文章</strong> / <small>Add Article</small></div>
</div>
<hr />

<div class="am-g">
    <div class="am-u-sm-12">
        <form class="am-form" id="AddArticleInfoForm">
            <!--文章分类下拉框-->
            <div id="selectDiv">
                <div class="am-form-group">
                    <label for="selectArticleType1">请选择分类</label>
                    <select id="selectArticleType1"></select>
                    <span class="am-form-caret"></span>
                </div>
            </div>
            <!--文章分类下拉框end-->
            <div class="am-form-group">
                <label for="doc-ipt-email-1">邮件</label>
                <input type="email" class="" id="doc-ipt-email-1" placeholder="输入电子邮件">
            </div>
        </form>
        <p><button type="button" class="am-btn am-btn-default">提交</button></p>
    </div>
</div>
<script>
    $(function () {
        //页面加载完毕时，加载一级分类数据。
        GetArticleType(0, "selectArticleType1");
    });
   
    //select编号
    var i = 1;
    //获取文章分类信息  parentId:父级id selectid:展示数据下拉框的Id
    GetArticleType = function (parentId, selectId) {
        $.post('@Url.Action("GetArticleType","ArticleType")', { parentId: parentId }, function (data) {
            data = $.parseJSON(data);
            if (data.status == "ok") {
                //判断当前selectId是否是第一个。第一个已经存在 无需创建，不是第一个就创建一个select
                if (selectId != "selectArticleType1") {
                    $("#selectDiv").append('<div class="am-form-group">' +
                             ' <label for="' + selectId + '">请选择分类</label>' +
                             ' <select id="' + selectId + '"></select>' +
                            '<span class="am-form-caret"></span></div>');
                }
                //为select填充数据
                //默认项
                $("#" + selectId).append('<option value="default">请选择</option>');
                //遍历
                $.each(data.articleTypeList, function (i, item) {
                    $("#" + selectId).append('<option value="' + item.Id + '">' + item.Title + '</option>');
                });
                //注册改变事件
                $("#" + selectId).change(function () {
                    //当前下拉框内容改变时。删除当前下拉框 后面的所有下拉框（这里的select都是包含在div里，所以要先获取父级元素div.）
                    $(this).parent().nextAll().remove();
                    //判断当前select的内容 是不是 默认项"请选择"。不是的话，就把当前选择内容的值（parentId）取出来，重新调用GetArticleType方法
                    if ($(this).val() != "default") {
                        i = i + 1;
                        GetArticleType($(this).val(), 'selectArticleType' + i);
                    }
                });
            }
        });
    };

</script>
